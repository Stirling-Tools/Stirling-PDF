<!DOCTYPE html>
<html th:data-language="${#locale.toString()}" th:dir="#{language.direction}" th:lang="${#locale.language}" xmlns:th="https://www.thymeleaf.org">
  <head>
    <th:block th:insert="~{fragments/common :: head(title=#{formFill.title}, header=#{formFill.header})}"></th:block>
  </head>
  <body>
    <div id="page-container">
      <div id="content-wrap">
        <th:block th:insert="~{fragments/navbar.html :: navbar}"></th:block>
        <br><br>
        <div class="container">
          <div class="row justify-content-center">
            <div class="col-lg-7 col-md-9 bg-card">
              <div class="tool-header mb-3">
                <span class="material-symbols-rounded tool-header-icon other">assignment</span>
                <span class="tool-header-text" th:text="#{formFill.header}"></span>
              </div>
              <p class="text-muted" th:text="#{formFill.description}"></p>

              <form autocomplete="off" data-skip-downloader id="formFillForm" novalidate>
                <div class="mb-3">
                  <label class="form-label" for="formFillFile-input" th:text="#{formFill.selectPdf}"></label>
                  <div th:replace="~{fragments/common :: fileSelector(name='formFillFile', multipleInputsForSingleRequest=false, disableMultipleFiles=true, accept='application/pdf')}"></div>
                </div>

                <div class="form-check ms-3">
                  <input id="formFillFlatten" name="flatten" type="checkbox" />
                  <label for="formFillFlatten" th:text="#{formFill.flattenLabel}"></label>
                </div>

                <div class="form-check ms-3">
                  <input id="formFillMultiTemplate" type="checkbox" />
                  <label for="formFillMultiTemplate" th:text="#{formFill.multiTemplateLabel}"></label>
                </div>
                <p class="form-text ms-3" th:text="#{formFill.multiTemplateHelp}"></p>

                <div class="alert alert-info mb-3" id="formFillStatus" role="alert" th:text="#{formFill.selectPrompt}"></div>

                <div class="d-none" id="formFillFields"></div>

                <div class="mb-3 text-start">
                  <button class="btn btn-primary" disabled id="formFillDownload" th:text="#{formFill.download}" type="button"></button>
                </div>

                <div class="mb-3">
                  <label class="form-label" for="formFillBatchJson" th:text="#{formFill.batchTitle}"></label>
                  <p class="form-text" th:text="#{formFill.batchHelp}"></p>
                  <textarea class="form-control" id="formFillBatchJson" placeholder='[{"field":"value"}]' rows="6"></textarea>
                </div>

                <div class="mb-3">
                  <label class="form-label" for="formFillBatchFile" th:text="#{formFill.batchFileLabel}"></label>
                  <p class="form-text" th:text="#{formFill.batchFileHelp}"></p>
                  <input accept="application/json,.json" class="form-control" id="formFillBatchFile" type="file" />
                </div>

                <div class="mb-2 text-start">
                  <button class="btn btn-outline-primary" disabled id="formFillBatchDownload" th:text="#{formFill.batchDownload}" type="button"></button>
                </div>
              </form>
            </div>
          </div>
        </div>

        <div aria-hidden="true" class="modal fade" id="formFieldEditModal" tabindex="-1">
          <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content">
              <form data-skip-downloader id="formFieldEditForm">
                <div class="modal-header">
                  <h5 class="modal-title" id="formFieldEditModalLabel" th:text="#{formFill.editModalTitle}"></h5>
                  <button aria-label="Close" class="btn-close" data-bs-dismiss="modal" type="button"></button>
                </div>
                <div class="modal-body">
                  <div class="row g-3">
                    <div class="col-md-6">
                      <label class="form-label" for="formFieldEditType" th:text="#{formFill.editType}"></label>
                      <select class="form-select" id="formFieldEditType">
                        <option th:text="#{formFill.type.text}" value="text"></option>
                        <option th:text="#{formFill.type.checkbox}" value="checkbox"></option>
                        <option th:text="#{formFill.type.combobox}" value="combobox"></option>
                        <option th:text="#{formFill.type.listbox}" value="listbox"></option>
                      </select>
                      <div class="form-text" th:text="#{formFill.editTypeHelp}"></div>
                    </div>
                    <div class="col-md-6">
                      <label class="form-label" for="formFieldEditName" th:text="#{formFill.editName}"></label>
                      <input class="form-control" id="formFieldEditName" maxlength="128" type="text" />
                      <div class="form-text" th:text="#{formFill.editNameHelp}"></div>
                    </div>
                    <div class="col-md-6">
                      <label class="form-label" for="formFieldEditLabel" th:text="#{formFill.editLabel}"></label>
                      <input class="form-control" id="formFieldEditLabel" maxlength="128" type="text" />
                      <div class="form-text" th:text="#{formFill.editLabelHelp}"></div>
                    </div>
                    <div class="col-md-6">
                      <label class="form-label" for="formFieldEditDefault" th:text="#{formFill.editDefault}"></label>
                      <input class="form-control" id="formFieldEditDefault" maxlength="256" type="text" />
                      <div class="form-text" th:text="#{formFill.editDefaultHelp}"></div>
                    </div>
                    <div class="col-12 d-none" id="formFieldEditOptionsGroup">
                      <label class="form-label" for="formFieldEditOptions" th:text="#{formFill.editOptions}"></label>
                      <textarea class="form-control" id="formFieldEditOptions" rows="3"></textarea>
                      <div class="form-text" th:text="#{formFill.editOptionsHelp}"></div>
                    </div>
                    <div class="col-md-6 d-none" id="formFieldEditMultiSelectGroup">
                      <div class="form-check">
                        <input id="formFieldEditMultiSelect" type="checkbox" />
                        <label for="formFieldEditMultiSelect" th:text="#{formFill.editMultiSelect}"></label>
                      </div>
                      <div class="form-text" th:text="#{formFill.editMultiSelectHelp}"></div>
                    </div>
                    <div class="col-md-6">
                      <div class="form-check">
                        <input id="formFieldEditRequired" type="checkbox" />
                        <label for="formFieldEditRequired" th:text="#{formFill.editRequired}"></label>
                      </div>
                    </div>
                    <div class="col-12">
                      <label class="form-label" for="formFieldEditTooltip" th:text="#{formFill.editTooltip}"></label>
                      <input class="form-control" id="formFieldEditTooltip" maxlength="256" type="text" />
                      <div class="form-text" th:text="#{formFill.editTooltipHelp}"></div>
                    </div>
                  </div>
                </div>
                <div class="modal-footer">
                  <button class="btn btn-outline-secondary" data-bs-dismiss="modal" th:text="#{cancel}" type="button"></button>
                  <button class="btn btn-primary" th:text="#{save}" type="submit"></button>
                </div>
              </form>
            </div>
          </div>
        </div>
        <br><br>
        <th:block th:insert="~{fragments/footer.html :: footer}"></th:block>
      </div>
    </div>
    <script th:src="@{'/js/form-fill.js'}" type="module"></script>
    <script th:inline="javascript">
      const formFillLocale = {
        noFields: /*[[#{formFill.noFields}]]*/ 'No fields detected.',
        loading: /*[[#{formFill.loading}]]*/ 'Reading form fields…',
        ready: /*[[#{formFill.ready}]]*/ 'Fields loaded. Enter values and press Download.',
        selectFile: /*[[#{formFill.selectPrompt}]]*/ 'Please choose a PDF form first.',
        parsingError: /*[[#{formFill.parsingError}]]*/ 'Unable to parse JSON payload.',
        requestError: /*[[#{formFill.requestError}]]*/ 'Something went wrong while communicating with the server.',
        unsupportedField: /*[[#{formFill.unsupportedField}]]*/ 'Unsupported field type',
        batchReady: /*[[#{formFill.batchReady}]]*/ 'Ready to generate batch output.',
        batchFileReady: /*[[#{formFill.batchFileReady}]]*/ "Batch file ready. You'll receive a combined PDF when you download.",
        multiTemplatePreview: /*[[#{formFill.multiTemplatePreview}]]*/ 'Multi-template mode enabled. The preview shows the first PDF; others will use JSON mapping when you download.',
        multiTemplateReady: /*[[#{formFill.multiTemplateReady}]]*/ 'Templates ready. Review the JSON payload then download to merge.',
        batchEmpty: /*[[#{formFill.batchEmpty}]]*/ 'Provide an array of JSON objects to enable batch generation.',
        pageLabel: /*[[#{formFill.pageLabel}]]*/ 'Page',
        keyLabel: /*[[#{formFill.keyLabel}]]*/ 'Key',
        validationRequired: /*[[#{formFill.validationRequired}]]*/ 'This field is required.',
        validationSelect: /*[[#{formFill.validationSelect}]]*/ 'Select at least one option.',
        validationDate: /*[[#{formFill.validationDate}]]*/ 'Enter a valid date (YYYY-MM-DD).',
        validationEmail: /*[[#{formFill.validationEmail}]]*/ 'Enter a valid email address.',
        validationInvalid: /*[[#{formFill.validationInvalid}]]*/ 'The provided value is not valid for this field.',
        validationFix: /*[[#{formFill.validationFix}]]*/ 'Fix the highlighted fields before downloading.',
        editField: /*[[#{formFill.editField}]]*/ 'Edit field',
        deleteField: /*[[#{formFill.deleteField}]]*/ 'Delete field',
        editUnavailable: /*[[#{formFill.editUnavailable}]]*/ 'Editing is currently unavailable.',
        editMultiDisabled: /*[[#{formFill.editMultiDisabled}]]*/ 'Turn off multi-template mode to edit individual fields.',
        editMissing: /*[[#{formFill.editMissing}]]*/ 'Unable to locate the selected field.',
        editUnsupported: /*[[#{formFill.editUnsupported}]]*/ 'This field type is not supported for editing yet.',
        deleteMissing: /*[[#{formFill.deleteMissing}]]*/ 'Unable to locate the selected field.',
        deleteConfirm: /*[[#{formFill.deleteConfirm}]]*/ 'Delete "{0}"? This action cannot be undone.',
        deleteSuccess: /*[[#{formFill.deleteSuccess}]]*/ 'Field deleted. Preview refreshed.',
        modifying: /*[[#{formFill.modifying}]]*/ 'Updating field…',
        deleting: /*[[#{formFill.deleting}]]*/ 'Deleting field…',
        modifySuccess: /*[[#{formFill.modifySuccess}]]*/ 'Field updated. Preview refreshed.',
        updating: /*[[#{formFill.modifying}]]*/ 'Updating field…',
        checkboxDefaultHint: /*[[#{formFill.checkboxDefaultHint}]]*/ 'Use true/false to control the initial state.',
        listboxDefaultHint: /*[[#{formFill.listboxDefaultHint}]]*/ 'Separate multiple selections with commas or new lines.'
      };
    </script>
  </body>
</html>
