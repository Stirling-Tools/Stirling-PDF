<!DOCTYPE html>
<html th:lang="${#locale.language}" th:dir="#{language.direction}" th:data-language="${#locale.toString()}"
      xmlns:th="https://www.thymeleaf.org">

<head>
    <th:block th:insert="~{fragments/common :: head(title=#{autoRedact.title}, header=#{autoRedact.header})}"></th:block>
    <style>
        .redaction-options-group {
            margin-bottom: 1rem;
        }

        .form-text.text-muted {
            color: #6c757d !important;
        }

        .btn-primary:focus, .form-check-input:focus, .form-control:focus, .form-select:focus {
            box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.25);
            outline: 2px solid #0d6efd;
            outline-offset: 2px;
        }

        .form-check-input:checked {
            background-color: #0d6efd;
            border-color: #0d6efd;
        }
    </style>
</head>

<body>
<div id="page-container">
    <div id="content-wrap">
        <th:block th:insert="~{fragments/navbar.html :: navbar}"></th:block>
        <br><br>
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-md-6 bg-card">
                    <div class="tool-header">
                        <svg class="material-symbols-rounded tool-header-icon security">
                            <use xlink:href="/images/redact-auto.svg#icon-redact-auto"></use>
                        </svg>
                        <span class="tool-header-text" id="form-title" th:text="#{autoRedact.header}"></span>
                    </div>
                                <form aria-labelledby="form-title" enctype="multipart/form-data" id="autoRedactForm"
                  method="post" th:action="@{'api/v1/security/auto-redact'}">
                        <div th:replace="~{fragments/common :: fileSelector(name='fileInput', multipleInputsForSingleRequest=false, disableMultipleFiles=true, accept='application/pdf')}"></div>

                        <div class="mb-3">
                            <label class="form-label" for="listOfText" th:text="#{autoRedact.textsToRedactLabel}"></label>
                            <textarea class="form-control" id="listOfText" name="listOfText" required rows="4"
                                      th:placeholder="#{autoRedact.textsToRedactPlaceholder}"></textarea>
                        </div>

                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" id="useRegex" name="useRegex" type="checkbox">
                                <label class="form-check-label" for="useRegex" th:text="#{autoRedact.useRegexLabel}"></label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" id="wholeWordSearch" name="wholeWordSearch" type="checkbox">
                                <label class="form-check-label" for="wholeWordSearch" th:text="#{autoRedact.wholeWordSearchLabel}"></label>
                            </div>
                        </div>

                        <div class="redaction-options-group">
                            <label class="form-label fw-bold mb-3">Redaction style</label>
                            <div class="form-check mb-2">
                                <input aria-describedby="visual-desc" class="form-check-input" id="visualImage" name="redactionMode" type="radio" value="visual">
                                <label class="form-check-label" for="visualImage">Visual</label>
                                <small class="form-text text-muted d-block mt-1" id="visual-desc">Converts to image with visual redactions for maximum security.</small>
                            </div>
                            <div class="form-check mb-2">
                                <input aria-describedby="delete-desc" class="form-check-input" id="deleteText" name="redactionMode" type="radio" value="aggressive">
                                <label class="form-check-label" for="deleteText">Delete Text</label>
                                <small class="form-text text-muted d-block mt-1" id="delete-desc">Removes the text completely. This may alter the original layout or leave a gap.</small>
                            </div>
                            <div class="form-check mb-3">
                                <input aria-describedby="keep-desc" checked class="form-check-input" id="keepLayout" name="redactionMode" type="radio" value="moderate">
                                <label class="form-check-label" for="keepLayout">Keep Layout</label>
                                <small class="form-text text-muted d-block mt-1" id="keep-desc">Covers text with a redaction box, preserving the page's original design.</small>
                            </div>

                            <div class="form-check">
                                <input aria-describedby="guarantee-desc" class="form-check-input" id="guaranteeRedaction" name="convertPDFToImage" type="checkbox">
                                <label class="form-check-label" for="guaranteeRedaction">PDF image</label>
                                <small class="form-text text-muted d-block mt-1" id="guarantee-desc">For maximum security, uses an image-based method to ensure text is unrecoverable. May slightly affect document quality.</small>
                            </div>
                        </div>

                        <br>

                        <div class="mb-3">
                            <label class="form-label" for="defaultColor" th:text="#{autoRedact.colorLabel}"></label>
                            <select class="form-select" id="defaultColor" name="defaultColor" onchange="handleColorChange(this.value)">
                                <option th:text="#{black}" value="#000000">Black</option>
                                <option th:text="#{white}" value="#FFFFFF">White</option>
                                <option th:text="#{red}" value="#FF0000">Red</option>
                                <option th:text="#{green}" value="#00FF00">Green</option>
                                <option th:text="#{blue}" value="#0000FF">Blue</option>
                                <option th:text="#{custom}" value="custom">Custom...</option>
                            </select>
                        </div>

                        <div class="mb-3" id="customColorContainer" style="display: none;">
                            <label class="form-label" for="customColor">Custom Color (Hex)</label>
                            <input class="form-control" id="customColor" name="redactColor" placeholder="#FF00FF" type="text">
                        </div>

                        <div class="mb-3">
                            <label class="form-label" for="customPadding" th:text="#{autoRedact.customPaddingLabel}"></label>
                            <input class="form-control" id="customPadding" max="1" min="0" name="customPadding"
                                   step="0.1" type="number" value="0.1">
                        </div>

                        <br>

                        <div class="mb-3">
                            <label class="form-label" for="ocrLanguage">OCR Language</label>
                            <select aria-describedby="ocr-desc" class="form-select" id="ocrLanguage" name="ocrLanguage">
                                <option value="eng">English</option>
                                <option value="spa">Spanish</option>
                                <option value="fra">French</option>
                                <option value="deu">German</option>
                                <option value="ita">Italian</option>
                                <option value="por">Portuguese</option>
                                <option value="rus">Russian</option>
                                <option value="ara">Arabic</option>
                                <option value="chi_sim">Chinese (Simplified)</option>
                                <option value="jpn">Japanese</option>
                                <option value="kor">Korean</option>
                                <option value="hin">Hindi</option>
                            </select>
                            <small class="form-text text-muted" id="ocr-desc">Used when OCR restoration is needed</small>
                        </div>

                        <input id="aggressiveMode" name="aggressiveMode" type="hidden" value="false">

                        <div class="mb-3 text-center">
                            <button class="btn btn-primary" id="submitBtn" th:text="#{autoRedact.submitButton}" type="submit"></button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <th:block th:insert="~{fragments/footer.html :: footer}"></th:block>
</div>
<script>
    function handleColorChange(selectedValue) {
        const container = document.getElementById('customColorContainer');
        const input = document.getElementById('customColor');
        if (selectedValue === "custom") {
            container.style.display = 'block';
            if (!input.value) {
                input.value = '#000000';
            }
        } else {
            container.style.display = 'none';
            input.value = selectedValue;
        }
    }

    document.addEventListener('DOMContentLoaded', function () {
        const redactionModeRadios = document.querySelectorAll('input[name="redactionMode"]');
        const aggressiveModeHidden = document.getElementById('aggressiveMode');
        const guaranteeRedactionCheckbox = document.getElementById('guaranteeRedaction');
        const defaultColor = document.getElementById('defaultColor');

        function updateMode() {
            const selectedMode = document.querySelector('input[name="redactionMode"]:checked');
            if (selectedMode) {
                // Set aggressive mode for delete text option
                aggressiveModeHidden.value = selectedMode.value === 'aggressive' ? 'true' : 'false';

                // Handle PDF image checkbox based on selection
                if (selectedMode.value === 'visual') {
                    // Visual mode automatically enables PDF image for maximum security
                    guaranteeRedactionCheckbox.checked = true;
                } else {
                    // Delete Text and Keep Layout modes disable PDF image
                    guaranteeRedactionCheckbox.checked = false;
                }
            }
        }

        redactionModeRadios.forEach(radio => {
            radio.addEventListener('change', updateMode);
        });

        if (defaultColor) {
            handleColorChange(defaultColor.value);
            // Set initial value for customColor input when a pre-defined color is selected
            const customColorInput = document.getElementById('customColor');
            if (defaultColor.value !== 'custom') {
                customColorInput.value = defaultColor.value;
            }
        }

        updateMode();
    });
</script>
</body>
</html>